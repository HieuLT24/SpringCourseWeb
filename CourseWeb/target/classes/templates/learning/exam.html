<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Làm bài kiểm tra - <span th:text="${course.title}">Tên khóa học</span></title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .exam-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 30px;
        }
        
        .exam-header {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .exam-timer {
            background: #fff;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        
        .timer-display {
            font-size: 2.5rem;
            font-weight: bold;
            color: #e74c3c;
        }
        
        .question-card {
            background: #fff;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border-left: 4px solid #3498db;
        }
        
        .question-number {
            background: #3498db;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-bottom: 15px;
        }
        
        .answer-option {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .answer-option:hover {
            background: #e3f2fd;
            border-color: #2196f3;
        }
        
        .answer-option.selected {
            background: #e3f2fd;
            border-color: #2196f3;
            color: #1976d2;
        }
        
        .exam-navigation {
            background: #fff;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-top: 30px;
        }
        
        .question-nav-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid #dee2e6;
            background: #fff;
            color: #6c757d;
            margin: 0 5px;
            transition: all 0.3s ease;
        }
        
        .question-nav-btn.answered {
            background: #28a745;
            border-color: #28a745;
            color: white;
        }
        
        .question-nav-btn.current {
            background: #007bff;
            border-color: #007bff;
            color: white;
        }
        
        .file-upload-section {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .back-to-course {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <!-- Nút quay lại khóa học -->
    <div class="back-to-course">
        <a th:href="@{/learning/course/{courseId}(courseId=${course.id})}" class="btn btn-outline-secondary">
            <i class="fas fa-arrow-left me-2"></i>Quay lại khóa học
        </a>
    </div>
    
    <div class="exam-container">
        <!-- Header bài kiểm tra -->
        <div class="exam-header">
            <h2 th:text="'Bài kiểm tra: ' + ${exam.type}">Bài kiểm tra</h2>
            <p class="mb-0">Khóa học: <span th:text="${course.title}">Tên khóa học</span></p>
        </div>
        
        <!-- Bộ đếm thời gian -->
        <div class="exam-timer">
            <h5>Thời gian còn lại</h5>
            <div class="timer-display" id="timer">30:00</div>
            <small class="text-muted">Phút : Giây</small>
        </div>
        
        <!-- Form bài kiểm tra -->
        <form th:action="@{/learning/course/{courseId}/exam/{examId}/submit(courseId=${course.id}, examId=${exam.id})}" method="post" id="examForm">
            <!-- Câu hỏi trắc nghiệm -->
            <div th:if="${exam.type == 'Trắc nghiệm'}" class="question-card">
                <div class="question-number">1</div>
                <h5>Câu hỏi 1: Khái niệm cơ bản về Spring Framework là gì?</h5>
                
                <div class="answer-option" onclick="selectAnswer(this, 'q1')">
                    <input type="radio" name="answers" value="A" style="display: none;">
                    <strong>A.</strong> Một framework để phát triển ứng dụng web
                </div>
                
                <div class="answer-option" onclick="selectAnswer(this, 'q1')">
                    <input type="radio" name="answers" value="B" style="display: none;">
                    <strong>B.</strong> Một ngôn ngữ lập trình mới
                </div>
                
                <div class="answer-option" onclick="selectAnswer(this, 'q1')">
                    <input type="radio" name="answers" value="C" style="display: none;">
                    <strong>C.</strong> Một hệ quản trị cơ sở dữ liệu
                </div>
                
                <div class="answer-option" onclick="selectAnswer(this, 'q1')">
                    <input type="radio" name="answers" value="D" style="display: none;">
                    <strong>D.</strong> Một hệ điều hành
                </div>
            </div>
            
            <div th:if="${exam.type == 'Trắc nghiệm'}" class="question-card">
                <div class="question-number">2</div>
                <h5>Câu hỏi 2: Dependency Injection trong Spring có tác dụng gì?</h5>
                
                <div class="answer-option" onclick="selectAnswer(this, 'q2')">
                    <input type="radio" name="answers" value="A" style="display: none;">
                    <strong>A.</strong> Tăng tốc độ xử lý
                </div>
                
                <div class="answer-option" onclick="selectAnswer(this, 'q2')">
                    <input type="radio" name="answers" value="B" style="display: none;">
                    <strong>B.</strong> Giảm sự phụ thuộc giữa các component
                </div>
                
                <div class="answer-option" onclick="selectAnswer(this, 'q2')">
                    <input type="radio" name="answers" value="C" style="display: none;">
                    <strong>C.</strong> Tăng bảo mật
                </div>
                
                <div class="answer-option" onclick="selectAnswer(this, 'q2')">
                    <input type="radio" name="answers" value="D" style="display: none;">
                    <strong>D.</strong> Giảm dung lượng code
                </div>
            </div>
            
            <!-- Phần nộp file -->
            <div th:if="${exam.type == 'Nộp file'}" class="question-card">
                <div class="question-number">1</div>
                <h5>Bài tập thực hành</h5>
                <p>Hãy tạo một ứng dụng Spring Boot đơn giản và nộp file source code.</p>
                
                <div class="file-upload-section">
                    <h6>Nộp file</h6>
                    <div class="mb-3">
                        <label for="fileUpload" class="form-label">Chọn file (ZIP, RAR, hoặc file code)</label>
                        <input type="file" class="form-control" id="fileUpload" name="fileUpload" accept=".zip,.rar,.java,.xml,.properties">
                        <div class="form-text">Kích thước file tối đa: 10MB</div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="description" class="form-label">Mô tả bài làm</label>
                        <textarea class="form-control" id="description" name="description" rows="4" placeholder="Mô tả ngắn gọn về bài làm của bạn..."></textarea>
                    </div>
                </div>
            </div>
            
            <!-- Nút nộp bài -->
            <div class="text-center mt-4">
                <button type="submit" class="btn btn-success btn-lg" onclick="return confirmSubmit()">
                    <i class="fas fa-paper-plane me-2"></i>Nộp bài
                </button>
            </div>
        </form>
        
        <!-- Điều hướng câu hỏi (cho bài trắc nghiệm) -->
        <div th:if="${exam.type == 'Trắc nghiệm'}" class="exam-navigation">
            <h6 class="text-center mb-3">Điều hướng câu hỏi</h6>
            <div class="text-center">
                <button type="button" class="question-nav-btn current" onclick="goToQuestion(1)">1</button>
                <button type="button" class="question-nav-btn" onclick="goToQuestion(2)">2</button>
                <button type="button" class="question-nav-btn" onclick="goToQuestion(3)">3</button>
                <button type="button" class="question-nav-btn" onclick="goToQuestion(4)">4</button>
                <button type="button" class="question-nav-btn" onclick="goToQuestion(5)">5</button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let timeLeft = 30 * 60; // 30 phút
        let timer;
        
        // Khởi tạo timer
        function startTimer() {
            timer = setInterval(function() {
                timeLeft--;
                updateTimerDisplay();
                
                if (timeLeft <= 0) {
                    clearInterval(timer);
                    alert('Hết thời gian làm bài! Hệ thống sẽ tự động nộp bài.');
                    document.getElementById('examForm').submit();
                }
            }, 1000);
        }
        
        // Cập nhật hiển thị timer
        function updateTimerDisplay() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            document.getElementById('timer').textContent = 
                (minutes < 10 ? '0' : '') + minutes + ':' + (seconds < 10 ? '0' : '') + seconds;
        }
        
        // Chọn đáp án
        function selectAnswer(element, questionId) {
            // Bỏ chọn tất cả đáp án khác trong cùng câu hỏi
            const questionCard = element.closest('.question-card');
            questionCard.querySelectorAll('.answer-option').forEach(option => {
                option.classList.remove('selected');
                option.querySelector('input[type="radio"]').checked = false;
            });
            
            // Chọn đáp án được click
            element.classList.add('selected');
            element.querySelector('input[type="radio"]').checked = true;
            
            // Cập nhật trạng thái câu hỏi đã trả lời
            updateQuestionStatus(questionId);
        }
        
        // Cập nhật trạng thái câu hỏi
        function updateQuestionStatus(questionId) {
            const questionNumber = questionId.replace('q', '');
            const navBtn = document.querySelector(`.question-nav-btn:nth-child(${questionNumber})`);
            if (navBtn) {
                navBtn.classList.add('answered');
            }
        }
        
        // Điều hướng đến câu hỏi
        function goToQuestion(questionNumber) {
            // Ẩn tất cả câu hỏi
            document.querySelectorAll('.question-card').forEach(card => {
                card.style.display = 'none';
            });
            
            // Hiển thị câu hỏi được chọn
            const selectedQuestion = document.querySelector(`.question-card:nth-child(${questionNumber})`);
            if (selectedQuestion) {
                selectedQuestion.style.display = 'block';
            }
            
            // Cập nhật trạng thái active của nút điều hướng
            document.querySelectorAll('.question-nav-btn').forEach(btn => {
                btn.classList.remove('current');
            });
            document.querySelector(`.question-nav-btn:nth-child(${questionNumber})`).classList.add('current');
        }
        
        // Xác nhận nộp bài
        function confirmSubmit() {
            return confirm('Bạn có chắc chắn muốn nộp bài? Không thể sửa đổi sau khi nộp.');
        }
        
        // Khởi tạo khi trang load
        document.addEventListener('DOMContentLoaded', function() {
            startTimer();
            
            // Chỉ hiển thị câu hỏi đầu tiên ban đầu
            if (document.querySelectorAll('.question-card').length > 1) {
                document.querySelectorAll('.question-card:not(:first-child)').forEach(card => {
                    card.style.display = 'none';
                });
            }
        });
    </script>
</body>
</html>
